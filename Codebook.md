---
title: "CodeBook for Getting and Cleaning Data Course Project"
author: "John Snell"
date: "16 August 2015"
output: html_document
---

##Description of Data
The input data for this task was obtained from: https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip

The zip file unpacks to reveal some high level files and two datasets: (a) Training dataset, (b) Testing dataset.   
Analysis of the two datasets shows they have exactly the same structure and appear to have been formed by splitting an original dataset based on 30 experimental subjects - the data for 21 of these individuals was used to form the training set, whereas the other 9 subjects' data formed the basis of the training set.   

###High level files:   

####README.txt   
Contains a high level description of the experiment and provides some details of the files to be found in the datasets.   

####Activity_labels.txt      
This file contains a list of 6 activity names, each name correspond to an activity id, 1 .. 6. The id is used to map activity names to activity ids contained in the Y files in the dataset.   

####Features_info.txt     
This file contains a description of the data collection and first order processing performed on the raw accelerometer and gyroscope data collected. It also describes the types of variables that the raw data was processed into. This is a precursor file to be read so that "features.txt" can be understood.

####Features.txt   
This file contains a table of 561 variable ids and names. Each of these variables has its own column in the X data file. The variable id identifies which column in the X dataset and allows the variable name to be associated with the correct data values.    

###Datatsets   
Each dataset consisted of a number of files:   

A subject file: contains a vector identifying the subject of the data for each row of the X and Y files.   

An X file: a table of values - the rows are organised to coincide with the subject and activity files - the values contained are processed values of raw input from acceleration and rotational sensors - the processing summarises raw data using mean, standard deviation and other statistical parameters.

A y file: contains a vector of activities that the subject was performing whilst acceleration and rotational data was being collected.  
   
There is also a folder containing the lowest level of data with acceleration and angular velocity measurements. These files have not been used in this task as all required data was available in the more processed variables in the X file.


##Explanation of Code   
The task as provided is required to complete 5 sub-tasks and the script is modelled on this functional breakdown:   

1.	Merge the training and the test sets to create one data set.   

```{r}
        mergeSets<-function (path,activityLabels)
```
2.	Extract measurements on the mean and standard deviation for each measurement. 

```{r}
        extractRequiredColumns<-function(mergeData,map)

```

3.	Use descriptive activity names to name the activities in the data set

```{r}
        #map activity number into activity label
        Activities<-sapply(YData,function(x){activityLabels$V2[x]})
       
        #combine the subject, activity and measurements into one dataframe
        loadedData<-cbind(subjectData,Activities,XData)


```

4.	Appropriately label the data set with descriptive variable names.  

```{r}

        colnames(extractedData)<-mapNames

```

5.	Create a new tidy data set with the average of each variable for each activity and each subject.

```{r}

        determineOutputSet<-function(inset)
        
```

####The production of a merged clean dataframe requires several steps:   
1. The loading  and merging of the subjects, the activities, and the processed data files into one dataframe for each of the datasets.The mapping of activity number to activity label is performed during the construction of the loaded data into the relevant dataframe.

```{r}
        loadData<-function(dataset, path, activityLabels)
        
        # the dataset parameter takes two values, c("train"", "test") to indicate which of the sets of 
        # files should be read.
        # the path parameter is a string indicating where the required files can found relative to the
        # current working directory.
        # the activityLabels parameter is a vector of labels for mapping from activity number as read in
        # from the files and a descriptor label indicating the nature of the activity.
 
```

2. The merging of the training and testing data frames.   
        As the two datasets are structurally identical and there is no overlap of subjects, the merging of the datasets can be a simple binding of the rows of one dataframe onto the other one. 
        
```{r}

       mergedData<-rbind(trainData,testData)

```

####The extraction of measurements on the mean and standard deviation for each measurement.  
The features file is loaded and searched for all variables containing the key strings, `c("-mean()","-std()")`. A vector containing the ids (corresponding to column indexes in the X data) is then used to extract the appropriate columns from the merged dataset.   Each column is extracted from the merged dataset and added to a new dataframe using the `cbind()` function.   
```{r}
        #extract dataframe has been created, so just add extracted column  (col) to dataframe
        extract <- cbind(extract,col)

```

####Assign descriptive activity names to name the activities.   
This is performed while the data sets are being loaded. The activity labels are preloaded. Once the Y file is loaded, a new vector, `Activities` is built using the `sapply()` function that has an activity label in the same position in its vector as the corresponding activity number in the Y file.

```{r}
        #map activity number into activity label - the x in the function is the activity number vector
        #as encoded in the Y file
        Activities<-sapply(YData,function(x){activityLabels$V2[x]})

```
The Activities vector is merged together with the Subjects data read from the subjects file, and the X data read from the X file, while constructing the required dataframe using the `r cbind()` function.   
```{r}
        #from the load_data function
        #Combine the subject, activity labels and measurements into one dataframe
        loadedData<-cbind(subjectData,Activities,XData)
```

####Label the data set with descriptive variable names   
When the script loads the features file and the ids of the mean and std deviation variables are identified, at the same time, a vector of map names with one entry per identified column is injected into the merged data set. These map names are the recognised name of that variable extracted from the features file. 

```{r}
        #create a vector of columnnames to go with extracted cols
        mapNames<-c("subject","activity",as.character(features$V2[map$V2]))
        #remove function brackets from columnnames
        mapNames<-sub("\\(\\)", "", mapNames)

```
The only processing is to remove any function brackets symbols, `()`, to tidy up the symbols. 
These map names are then injected into the extracted data frame. 
```{r}
        #set column names
        colnames(extractedData)<-mapNames

```

The names as used in the features files are already descriptive. Whilst this could possibly be augmented using the Read me and the features_info files, it was considered that this would probably add little value especially relative to the amount of effort required to do it effectively.


####new tidy data set with the average of each variable for each activity and each subject   
The `dplyr` package was used to fulfil this requirement. Essentially a summary data set, the average values for each of the extracted variables, is required for each activity for each subject.
The `group_by()` function was used on the extracted data where the grouping was intially by subject and them each activity for each subject. Once the datset was appopriately grouped, then the `summarise_each()` function from the package was used to determine the means of each of the variables contained within the dataset. The pipe operator `%>%` was used to chain the `dplyr` functions together.
```{r}
        output<-inset%>%group_by(subject,activity)%>%summarise_each(funs(mean))
```


This summarised dataset was used to produce the output from the `run_analysis()` script.   

I found the wording for this requirement to be imprecise. I eventually decided to `group by` subject and then activity, it could be that intention of the assignment was to `group by` activity and then by subject. However, the final text file is loadable into spreadsheet applications such as `Excel` in which case the data can be easily and quickly re-sorted to the latter case.



##Explanation of Script Output
The final output of the script stores the clean, tidy summary dataset into a text file in the working directory, it also exports the data set to the caller of the `run_analysis(path)` function.
The strucutre of the output is:   
```
Classes 'grouped_df', 'tbl_df', 'tbl' and 'data.frame':	180 obs. of  81 variables:
 $ subject                      : int  1 1 1 1 1 1 2 2 2 2 ...
 $ activity                     : Factor w/ 6 levels "LAYING","SITTING",..: 1 2 3 4 5 6 1 2 3 4 ...
 $ tBodyAcc-mean-X              : num  0.222 0.261 0.279 0.277 0.289 ...
 $ tBodyAcc-mean-Y              : num  -0.04051 -0.00131 -0.01614 -0.01738 -0.00992 ...
 $ tBodyAcc-mean-Z              : num  -0.113 -0.105 -0.111 -0.111 -0.108 ...
 $ tBodyAcc-std-X               : num  -0.928 -0.977 -0.996 -0.284 0.03 ...
 $ tBodyAcc-std-Y               : num  -0.8368 -0.9226 -0.9732 0.1145 -0.0319 ...
 $ tBodyAcc-std-Z               : num  -0.826 -0.94 -0.98 -0.26 -0.23 ...
 $ tGravityAcc-mean-X           : num  -0.249 0.832 0.943 0.935 0.932 ...
 $ tGravityAcc-mean-Y           : num  0.706 0.204 -0.273 -0.282 -0.267 ...
 $ tGravityAcc-mean-Z           : num  0.4458 0.332 0.0135 -0.0681 -0.0621 ...
 $ tGravityAcc-std-X            : num  -0.897 -0.968 -0.994 -0.977 -0.951 ...
 $ tGravityAcc-std-Y            : num  -0.908 -0.936 -0.981 -0.971 -0.937 ...
 $ tGravityAcc-std-Z            : num  -0.852 -0.949 -0.976 -0.948 -0.896 ...
 $ tBodyAccJerk-mean-X          : num  0.0811 0.0775 0.0754 0.074 0.0542 ...
 $ tBodyAccJerk-mean-Y          : num  0.003838 -0.000619 0.007976 0.028272 0.02965 ...
 $ tBodyAccJerk-mean-Z          : num  0.01083 -0.00337 -0.00369 -0.00417 -0.01097 ...
 $ tBodyAccJerk-std-X           : num  -0.9585 -0.9864 -0.9946 -0.1136 -0.0123 ...
 $ tBodyAccJerk-std-Y           : num  -0.924 -0.981 -0.986 0.067 -0.102 ...
 $ tBodyAccJerk-std-Z           : num  -0.955 -0.988 -0.992 -0.503 -0.346 ...
 $ tBodyGyro-mean-X             : num  -0.0166 -0.0454 -0.024 -0.0418 -0.0351 ...
 $ tBodyGyro-mean-Y             : num  -0.0645 -0.0919 -0.0594 -0.0695 -0.0909 ...
 $ tBodyGyro-mean-Z             : num  0.1487 0.0629 0.0748 0.0849 0.0901 ...
 $ tBodyGyro-std-X              : num  -0.874 -0.977 -0.987 -0.474 -0.458 ...
 $ tBodyGyro-std-Y              : num  -0.9511 -0.9665 -0.9877 -0.0546 -0.1263 ...
 $ tBodyGyro-std-Z              : num  -0.908 -0.941 -0.981 -0.344 -0.125 ...
 $ tBodyGyroJerk-mean-X         : num  -0.1073 -0.0937 -0.0996 -0.09 -0.074 ...
 $ tBodyGyroJerk-mean-Y         : num  -0.0415 -0.0402 -0.0441 -0.0398 -0.044 ...
 $ tBodyGyroJerk-mean-Z         : num  -0.0741 -0.0467 -0.049 -0.0461 -0.027 ...
 $ tBodyGyroJerk-std-X          : num  -0.919 -0.992 -0.993 -0.207 -0.487 ...
 $ tBodyGyroJerk-std-Y          : num  -0.968 -0.99 -0.995 -0.304 -0.239 ...
 $ tBodyGyroJerk-std-Z          : num  -0.958 -0.988 -0.992 -0.404 -0.269 ...
 $ tBodyAccMag-mean             : num  -0.8419 -0.9485 -0.9843 -0.137 0.0272 ...
 $ tBodyAccMag-std              : num  -0.7951 -0.9271 -0.9819 -0.2197 0.0199 ...
 $ tGravityAccMag-mean          : num  -0.8419 -0.9485 -0.9843 -0.137 0.0272 ...
 $ tGravityAccMag-std           : num  -0.7951 -0.9271 -0.9819 -0.2197 0.0199 ...
 $ tBodyAccJerkMag-mean         : num  -0.9544 -0.9874 -0.9924 -0.1414 -0.0894 ...
 $ tBodyAccJerkMag-std          : num  -0.9282 -0.9841 -0.9931 -0.0745 -0.0258 ...
 $ tBodyGyroMag-mean            : num  -0.8748 -0.9309 -0.9765 -0.161 -0.0757 ...
 $ tBodyGyroMag-std             : num  -0.819 -0.935 -0.979 -0.187 -0.226 ...
 $ tBodyGyroJerkMag-mean        : num  -0.963 -0.992 -0.995 -0.299 -0.295 ...
 $ tBodyGyroJerkMag-std         : num  -0.936 -0.988 -0.995 -0.325 -0.307 ...
 $ fBodyAcc-mean-X              : num  -0.9391 -0.9796 -0.9952 -0.2028 0.0382 ...
 $ fBodyAcc-mean-Y              : num  -0.86707 -0.94408 -0.97707 0.08971 0.00155 ...
 $ fBodyAcc-mean-Z              : num  -0.883 -0.959 -0.985 -0.332 -0.226 ...
 $ fBodyAcc-std-X               : num  -0.9244 -0.9764 -0.996 -0.3191 0.0243 ...
 $ fBodyAcc-std-Y               : num  -0.834 -0.917 -0.972 0.056 -0.113 ...
 $ fBodyAcc-std-Z               : num  -0.813 -0.934 -0.978 -0.28 -0.298 ...
 $ fBodyAcc-meanFreq-X          : num  -0.1588 -0.0495 0.0865 -0.2075 -0.3074 ...
 $ fBodyAcc-meanFreq-Y          : num  0.0975 0.0759 0.1175 0.1131 0.0632 ...
 $ fBodyAcc-meanFreq-Z          : num  0.0894 0.2388 0.2449 0.0497 0.2943 ...
 $ fBodyAccJerk-mean-X          : num  -0.9571 -0.9866 -0.9946 -0.1705 -0.0277 ...
 $ fBodyAccJerk-mean-Y          : num  -0.9225 -0.9816 -0.9854 -0.0352 -0.1287 ...
 $ fBodyAccJerk-mean-Z          : num  -0.948 -0.986 -0.991 -0.469 -0.288 ...
 $ fBodyAccJerk-std-X           : num  -0.9642 -0.9875 -0.9951 -0.1336 -0.0863 ...
 $ fBodyAccJerk-std-Y           : num  -0.932 -0.983 -0.987 0.107 -0.135 ...
 $ fBodyAccJerk-std-Z           : num  -0.961 -0.988 -0.992 -0.535 -0.402 ...
 $ fBodyAccJerk-meanFreq-X      : num  0.132 0.257 0.314 -0.209 -0.253 ...
 $ fBodyAccJerk-meanFreq-Y      : num  0.0245 0.0475 0.0392 -0.3862 -0.3376 ...
 $ fBodyAccJerk-meanFreq-Z      : num  0.02439 0.09239 0.13858 -0.18553 0.00937 ...
 $ fBodyGyro-mean-X             : num  -0.85 -0.976 -0.986 -0.339 -0.352 ...
 $ fBodyGyro-mean-Y             : num  -0.9522 -0.9758 -0.989 -0.1031 -0.0557 ...
 $ fBodyGyro-mean-Z             : num  -0.9093 -0.9513 -0.9808 -0.2559 -0.0319 ...
 $ fBodyGyro-std-X              : num  -0.882 -0.978 -0.987 -0.517 -0.495 ...
 $ fBodyGyro-std-Y              : num  -0.9512 -0.9623 -0.9871 -0.0335 -0.1814 ...
 $ fBodyGyro-std-Z              : num  -0.917 -0.944 -0.982 -0.437 -0.238 ...
 $ fBodyGyro-meanFreq-X         : num  -0.00355 0.18915 -0.12029 0.01478 -0.10045 ...
 $ fBodyGyro-meanFreq-Y         : num  -0.0915 0.0631 -0.0447 -0.0658 0.0826 ...
 $ fBodyGyro-meanFreq-Z         : num  0.010458 -0.029784 0.100608 0.000773 -0.075676 ...
 $ fBodyAccMag-mean             : num  -0.8618 -0.9478 -0.9854 -0.1286 0.0966 ...
 $ fBodyAccMag-std              : num  -0.798 -0.928 -0.982 -0.398 -0.187 ...
 $ fBodyAccMag-meanFreq         : num  0.0864 0.2367 0.2846 0.1906 0.1192 ...
 $ fBodyBodyAccJerkMag-mean     : num  -0.9333 -0.9853 -0.9925 -0.0571 0.0262 ...
 $ fBodyBodyAccJerkMag-std      : num  -0.922 -0.982 -0.993 -0.103 -0.104 ...
 $ fBodyBodyAccJerkMag-meanFreq : num  0.2664 0.3519 0.4222 0.0938 0.0765 ...
 $ fBodyBodyGyroMag-mean        : num  -0.862 -0.958 -0.985 -0.199 -0.186 ...
 $ fBodyBodyGyroMag-std         : num  -0.824 -0.932 -0.978 -0.321 -0.398 ...
 $ fBodyBodyGyroMag-meanFreq    : num  -0.139775 -0.000262 -0.028606 0.268844 0.349614 ...
 $ fBodyBodyGyroJerkMag-mean    : num  -0.942 -0.99 -0.995 -0.319 -0.282 ...
 $ fBodyBodyGyroJerkMag-std     : num  -0.933 -0.987 -0.995 -0.382 -0.392 ...
 $ fBodyBodyGyroJerkMag-meanFreq: num  0.176 0.185 0.334 0.191 0.19 ...
 - attr(*, "vars")=List of 1
  ..$ : symbol subject
 - attr(*, "drop")= logi TRUE
```
